<div class="active-content__details js-autosave-form">
  <%= form_for [current_audit, structure], remote: true do |f| %>
    <fieldset>
      <legend class="section-title">
        Structure
      </legend>

      <div class="form-row">
        <%= f.label :name, class: 'form-row__label' %>
        <%= f.text_field :name, disabled: !can_edit? %>
      </div>

      <div class="form-row">
        <%= label_tag :structure_type, 'Type', class: 'form-row__label' %>
        <%= text_field_tag :structure_type, structure.structure_type.name, disabled: true %>
      </div>
    </fieldset>
  <%- end %>

  <%- if structure.physical_structure %>
    <%= render structure.physical_structure_type.downcase,
          physical_structure: structure.physical_structure %>
  <%- end %>

    <%- StructureDetailsPresenter.new(structure).groupings.each do |grouping| %>
    <fieldset>
      <legend class="section-title">
        <%= grouping.name %>
      </legend>
      <%- grouping.fields.each do |field| %>
        <%= form_for [current_audit, field],
              method: :put,
              remote: true do |f| %>
          <%= hidden_field_tag :structure_id, structure.id %>
          <div class="form-row">
            <%= label_tag field.name.parameterize,
                  field.name,
                  class: 'form-row__label' %>
            <% if field.value_type != 'picker' %>
              <%= render "web/fields/#{field.partial}",
                    name: field.name.parameterize,
                    value: field.field_value_value %>
            <% else %>
              <%= render "web/fields/#{field.partial}",
                    name: field.name.parameterize,
                    value: field.field_value,
                    seldefault: field.string_value %>
            <% end %>
          </div>
        <%- end %>
      <%- end %>
    </fieldset>
    <%- end %>
  </form>
</div>
